<!doctype html>

<html lang='en'>
<head>
  <meta charset='utf-8'>
  <title>Three Node Block Transactions (Gas)</title>
  <style type="text/css">
  body {
    background-color: #0B1719;
  }

  h6 {
    margin: 2px;
  }

  th {
    padding: 30px;
  }

  table {
    float: left;
    width : 1px
  }

  h1, h6, td, th {
    color: #20b2aa;
    font-family: arial, sans-serif;
    font-size: 450%;
  }

  h1 {
    margin-bottom: 0px;
  }

  h1, #author {
    display:flex;
    justify-content:center;
    align-items:center;
  }

  #container {
    position: absolute;
    width: 100%;
    height: 100%;
    margin-left: 1000px;
  }

  #graph_container {
    position: relative;
    top: 20px;
    height: 4100px;
    width: 4100px;
  }

  </style>
</head>

<body>
  <div class="information">
    <h1 id='title'><u>ETHEREUM TRANSACTIONS</u></h1>
    <h6 id='author'>Aneeque Safdar and David Birch</h6>

    <table>
      <tr>
        <th><u>Graph Information</u></th>
      </tr>
      <tr>
        <td id='info1'></td>
      </tr>
      <tr>
        <td id='info2'></td>
      </tr>
      <tr>
        <td id='info3'></td>
      </tr>
      <tr>
        <td id='info4'></td>
      </tr>
      <tr>
        <td id='info5'></td>
      </tr>
      <tr>
        <td id='info6'></td>
      </tr>

      <tr>
        <th><u>Accounts</u></th>
      </tr>
      <tr>
        <td id='acc1'></td>
      </tr>
      <tr>
        <td id='acc2'></td>
      </tr>
      <tr>
        <td id='acc3'></td>
      </tr>


      <tr>
        <th><u>Gas Consumed</u></th>
      </tr>
      <tr>
        <td id='gas1'></td>
      </tr>
      <tr>
        <td id='gas2'></td>
      </tr>
      <tr>
        <td id='gas3'></td>
      </tr>
      <tr>
        <td id='gas4'></td>
      </tr>

      <tr>
        <th><u>Ether Transferred</u></th>
      </tr>
      <tr>
        <td id='eth1'></td>
      </tr>
      <tr>
        <td id='eth2'></td>
      </tr>
      <tr>
        <td id='eth3'></td>
      </tr>
      <tr>
        <td id='eth4'></td>
      </tr>
    </table>

  </div>

  <div id='graph_container'>
    <div id='container'></div>
  </div>

  <script type="text/javascript" src='../../../../utils/external_libs/sigmajs/sigma.min.js'></script>
  <script type="text/javascript" src='../../../../utils/external_libs/sigmajs/plugins/sigma.parsers.json.min.js'></script>
  <script type="text/javascript" src='../../../../utils/external_libs/sigmajs/plugins/sigma.layout.forceAtlas2.min.js'></script>
  <script type="text/javascript" src='../../../../utils/http.js'></script>
  <script type="text/javascript">
  var paths = window.location.pathname.split('/');
  var account = paths[2];
  var blockNumberOrHash = paths[3];
  var count = paths[4];
  console.log(paths);

  // var blockUrl = "http://localhost:3000/api/account"; //when running locally
  var blockUrl = "http://146.169.46.80:3000/api/account";
  var url = blockUrl + '/' + account + '/' + blockNumberOrHash  + '/' + count + '/ether';

  var graph;

  http.get(url, function(res, err) {
    if (res != null) {
      graph = JSON.parse(res);
      console.log(graph);
      console.log("Nodes: " + graph.nodes.length);
      console.log("Edges: " + graph.edges.length);
      createGraph(graph, 'container');

      document.getElementById('info1').innerHTML = 'Starting Block number or hash = ' + blockNumberOrHash;
      document.getElementById('info2').innerHTML = 'Starting Block Mined @ ' + graph.minedAt;
      document.getElementById('info3').innerHTML  ='Blocks = ' + count;
      document.getElementById('info4').innerHTML  ='Active Blocks = ' + graph.activeBlocks;
      document.getElementById('info5').innerHTML = 'Nodes = ' + graph.nodes.length;
      document.getElementById('info6').innerHTML  ='Edges = ' + graph.edges.length;

      document.getElementById('acc1').innerHTML  ='Account Address = \n' + graph.account;
      document.getElementById('acc2').innerHTML = 'Externally Owned Accounts = ' + graph.eoas;
      document.getElementById('acc3').innerHTML  ='Contract Account = ' + graph.contracts;

      document.getElementById('gas1').innerHTML = 'Maximum = ' + graph.maxGas;
      document.getElementById('gas2').innerHTML  ='Minimum = ' + graph.minGas;
      document.getElementById('gas3').innerHTML = 'Average = ' + graph.averageGas;
      document.getElementById('gas4').innerHTML = 'Total = ' + graph.totalGas;

      document.getElementById('eth1').innerHTML = 'Maximum = ' + graph.maxEther;
      document.getElementById('eth2').innerHTML  ='Minimum = ' + graph.minEther;
      document.getElementById('eth3').innerHTML = 'Average = ' + graph.averageEther;
      document.getElementById('eth4').innerHTML = 'Total = ' + graph.totalEther;


    } else {
      console.error('GET ERROR: ' + err);
    }
  })


  function createGraph(g, container) {
    var renderer = {
      container: container,
      type: 'canvas'
    }


    var graphSettings = {
      minNodeSize: 1.5,
      maxNodeSize: 3.5,
      // minEdgeSize: 1.5,
      // maxEdgeSize: 4.5,
      scalingMode: "inside",
      sideMargin: 10
    }

    var forceConfig = {
      worker: true,
      barnesHutOptimize: true,
      strongGravityMode:true,
      startingIterations: 100,
      slowDown: 2
    }

    var s = new sigma({
      graph: g,
      renderer: renderer,
      settings: graphSettings
    })
    //Start Force Atlas algorithm
    s.startForceAtlas2(forceConfig);
    setTimeout(function() {
      s.killForceAtlas2();
    },600000);
  }

  </script>
</body>
</html>
