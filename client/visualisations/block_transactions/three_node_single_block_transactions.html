<!doctype html>

<html lang='en'>
<head>
  <meta charset='utf-8'>
  <title>Block Transactions</title>
  <style type="text/css">
  body {
    margin: 0;
  }
  #container {
    position: absolute;
    width: 100%;
    height: 100%;
    background-color: #0F1D20;
  }
  </style>
</head>

<body>
  <div id='container'></div>

  <script type="text/javascript" src='../../utils/external_libs/sigmajs/sigma.min.js'></script>
  <script type="text/javascript" src='../../utils/external_libs/sigmajs/plugins/sigma.parsers.json.min.js'></script>
  <script type="text/javascript" src='../../utils/external_libs/sigmajs/plugins/sigma.layout.forceAtlas2.min.js'></script>
  <script type="text/javascript" src='../../utils/external_libs/bignumber.min.js'></script>
  <script type="text/javascript" src='../../utils/http.js'></script>
  <script type="text/javascript" src='../../utils/three_node_transaction_graph.js'></script>
  <script type="text/javascript">
  //Example blocks
  // var blockNumberOrHash = 3320744;
  // var blockNumberOrHash = 3312599;
  // var blockNumberOrHash = 3320787;
  // var blockNumberOrHash = 3327346;
  // var blockNumberOrHash = 3329340;
  // var blockNumberOrHash = 2740710;
  // var blockNumberOrHash = 3330615;
  // var blockNumberOrHash = 3347713;

  var paths = window.location.pathname.split('/');
  var blockNumberOrHash = paths[2];

  //var blockUrl = "http://127.0.0.1:3000/api/block"; //When running locally
  var blockUrl = "http://146.169.46.159:3000/api/block"; //When running on vm

  var url = blockUrl + '/' + blockNumberOrHash + '/WithTransactionsAndAccounts';

  http.get(url, function(res, err) {
    if (res != null) {
      var block = JSON.parse(res);
      var blockTransactions = block.transactions;
      createGraph(blockTransactions, 'container');
    } else {
      console.error('GET ERROR: ' + err);
    }
  });

  function createGraph(transactions, container) {
    var g = new ThreeNodeTransactionGraph(transactions);

    var graphSettings = {
      minNodeSize: 1,
      maxNodeSize: 2,
      // minEdgeSize: 10,
      // maxEdgeSize: 10,
      scalingMode: "inside",
      sideMargin: 10
    }

    var forceConfig = {
      worker: true,
      barnesHutOptimize: true,
      gravity: 15,
      // strongGravityMode:true,
      slowDown: 50
    }

    var s = new sigma({
      graph: g,
      container: container,
      settings: graphSettings
    })
    //Start Force Atlas algorithm
    s.startForceAtlas2(forceConfig);
  }

  </script>
</body>
</html>
